import*as t from"pixi.js";var e=function(){if("undefined"==typeof document)return"transform";for(var t=["oTransform","msTransform","mozTransform","webkitTransform","transform"],e=document.createElement("div").style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return"transform"}();function i(t){var e=document.createElement("div");if(e.style.cssText="position:absolute;","function"==typeof t.render){var i=t.render();if(i instanceof HTMLElement)return e.appendChild(i),e}if(e.textContent=t.text,t.style)for(var n in t.style)e.style[n]=t.style[n];return e}var n={name:"dom",init:function(){var t=document.createElement("div");return t.style.cssText="overflow:hidden;white-space:nowrap;transform:translateZ(0);",t},clear:function(t){for(var e=t.lastChild;e;)t.removeChild(e),e=t.lastChild},resize:function(t,e,i){t.style.width=e+"px",t.style.height=i+"px"},framing:function(){},setup:function(t,e){var n=document.createDocumentFragment(),s=0,r=null;for(s=0;s<e.length;s++)(r=e[s]).node=r.node||i(r),n.appendChild(r.node);for(e.length&&t.appendChild(n),s=0;s<e.length;s++)(r=e[s]).width=r.width||r.node.offsetWidth,r.height=r.height||r.node.offsetHeight},render:function(t,i){i.node.style[e]="translate("+i.x+"px,"+i.y+"px)"},remove:function(t,e){t.removeChild(e.node),this.media||(e.node=null)}},s="undefined"!=typeof window&&window.devicePixelRatio||1,r=Object.create(null);function o(t,e){if("function"==typeof t.render){var i=t.render();if(i instanceof HTMLCanvasElement)return t.width=i.width,t.height=i.height,i}var n=document.createElement("canvas"),o=n.getContext("2d"),a=t.style||{};a.font=a.font||"10px sans-serif",a.textBaseline=a.textBaseline||"bottom";var h=1*a.lineWidth;for(var d in h=h>0&&h!==1/0?Math.ceil(h):1*!!a.strokeStyle,o.font=a.font,t.width=t.width||Math.max(1,Math.ceil(o.measureText(t.text).width)+2*h),t.height=t.height||Math.ceil(function(t,e){if(r[t])return r[t];var i=12,n=t.match(/(\d+(?:\.\d+)?)(px|%|em|rem)(?:\s*\/\s*(\d+(?:\.\d+)?)(px|%|em|rem)?)?/);if(n){var s=1*n[1]||10,o=n[2],a=1*n[3]||1.2,h=n[4];"%"===o&&(s*=e.container/100),"em"===o&&(s*=e.container),"rem"===o&&(s*=e.root),"px"===h&&(i=a),"%"===h&&(i=s*a/100),"em"===h&&(i=s*a),"rem"===h&&(i=e.root*a),void 0===h&&(i=s*a)}return r[t]=i,i}(a.font,e))+2*h,n.width=t.width*s,n.height=t.height*s,o.scale(s,s),a)o[d]=a[d];var l=0;switch(a.textBaseline){case"top":case"hanging":l=h;break;case"middle":l=t.height>>1;break;default:l=t.height-h}return a.strokeStyle&&o.strokeText(t.text,h,l),o.fillText(t.text,h,l),n}function a(t){return 1*window.getComputedStyle(t,null).getPropertyValue("font-size").match(/(.+)px/)[1]}var h={name:"canvas",init:function(t){var e=document.createElement("canvas");return e.context=e.getContext("2d"),e._fontSize={root:a(document.getElementsByTagName("html")[0]),container:a(t)},e},clear:function(t,e){t.context.clearRect(0,0,t.width,t.height);for(var i=0;i<e.length;i++)e[i].canvas=null},resize:function(t,e,i){t.width=e*s,t.height=i*s,t.style.width=e+"px",t.style.height=i+"px"},framing:function(t){t.context.clearRect(0,0,t.width,t.height)},setup:function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.canvas=o(n,t._fontSize)}},render:function(t,e){t.context.drawImage(e.canvas,e.x*s,e.y*s)},remove:function(t,e){e.canvas=null}};function d(t){return parseFloat(window.getComputedStyle(t).getPropertyValue("font-size"))}var l={name:"pixi",init:function(e){const i=new t.Application({resizeTo:e,backgroundAlpha:0,antialias:!0});return i._fontSize={root:d(document.documentElement),container:d(e)},i.view._app=i,i.view},clear:function(t,e){t._app.stage.removeChildren(),e.forEach((t=>{t.sprite=null}))},resize:function(t,e,i){t._app.renderer.resize(e,i)},framing:function(t){},setup:function(e,i){const n=e._app;i.forEach((e=>{e.sprite=function(e){const i={fontSize:e.style?.fontSize||"10px",fontFamily:e.style?.fontFamily||"Arial",fill:e.style?.fill||"#ffffff",align:e.style?.align||"left"},n=new t.TextStyle(i);return new t.Text(e.text,n)}(e,n._fontSize)}))},render:function(t,e){const i=t._app;e.sprite.x=e.x,e.sprite.y=e.y,i.stage.addChild(e.sprite)},remove:function(t,e){const i=t._app;e.sprite&&(i.stage.removeChild(e.sprite),e.sprite.destroy(),e.sprite=null)}};function c(t){const e=this,i=e.media?e.media.currentTime:Date.now()/1e3,n=e.media?e.media.playbackRate:1,s=t.mode,r=t.height,o=e._.height,a=Math.floor(o/r);e._.space[s]&&e._.space[s].length===a||(e._.space[s]=new Array(a).fill(null).map((()=>({endTime:0}))));const h=e._.space[s];let d=-1;function l(t,e,i,n,s,r){if(!t||!t.endTime)return!0;if(i>=t.endTime)return!0;if("ltr"===s||"rtl"===s){const o=i-t.startTime,a=i-e.time,h=r._.duration/n,d=r._.width,l=o/h*d,c=a/h*d;let u=0,m=0,f=0,p=0;if("rtl"===s?(u=r._.width-l,m=u+t.width,f=r._.width-c,p=f+e.width):(m=-t.width+l,u=m-t.width,p=-e.width+c,f=p-e.width),f<m&&p>u||p>u&&f<m)return!1}if("top"===s||"bottom"===s){const e=r._.duration/n;return i-t.startTime>=e}return!0}for(let r=0;r<a;r++){if(l(h[r],t,i,n,s,e)){d=r;break}}if(-1===d)return-1;const c=e.media?t.time:t._utc,u=c+e._.duration/n;h[d]={startTime:c,endTime:u,width:t.width,height:t.height};return"bottom"===s?o-(d+1)*r:d*r}var u="undefined"!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){return setTimeout(t,50/3)},m="undefined"!=typeof window&&(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||clearTimeout;function f(t,e,i){for(var n=0,s=0,r=t.length;s<r-1;)i>=t[n=s+r>>1][e]?s=n:r=n;return t[s]&&i<t[s][e]?s:r}function p(t){return/^(ltr|top|bottom)$/i.test(t)?t.toLowerCase():"rtl"}function _(t){t.ltr=[],t.rtl=[],t.top=[],t.bottom=[]}function g(){if(!this._.visible||!this._.paused)return this;if(this._.paused=!1,this.media)for(var t=0;t<this._.runningList.length;t++){var e=this._.runningList[t];e._utc=Date.now()/1e3-(this.media.currentTime-e.time)}var i=this,n=function(t,e,i,n){return function(s){let r=s;void 0===r&&(r=Date.now()),t(this._.stage);const o=r/1e3,a=this.media?this.media.currentTime:o,h=this.media?this.media.playbackRate:1;let d=null,l=0,u=0;for(u=this._.runningList.length-1;u>=0;u--){d=this._.runningList[u],l=this.media?d.time:d._utc;const t=(o-d._utc)*h;let e=!1;"top"===d.mode||"bottom"===d.mode?t>this._.duration&&(e=!0):"ltr"===d.mode?d.x>this._.width&&(e=!0):"rtl"===d.mode&&d.x+d.width<0&&(e=!0),e&&(n(this._.stage,d),this._.runningList.splice(u,1))}const m=[];for(;this._.position<this.comments.length&&(d=this.comments[this._.position],l=this.media?d.time:d._utc,!(l>=a));)a-l>this._.duration||(this.media&&(d._utc=o-(this.media.currentTime-d.time)),m.push(d)),++this._.position;for(e(this._.stage,m),u=0;u<m.length;u++)d=m[u],d.y=c.call(this,d),this._.runningList.push(d);for(u=0;u<this._.runningList.length;u++){if(d=this._.runningList[u],-1===d.y)continue;const t=(o-d._utc)*h/this._.duration,e=this._.width*t;"ltr"===d.mode?d.x=-d.width+e:"rtl"===d.mode?d.x=this._.width-e:"top"!==d.mode&&"bottom"!==d.mode||(d.x=(this._.width-d.width)/2),d.element&&d.element.style&&(d.element.style.transform=`translate(${d.x}px, ${d.y}px)`),i(this._.stage,d)}}}(this._.engine.framing.bind(this),this._.engine.setup.bind(this),this._.engine.render.bind(this),this._.engine.remove.bind(this));return this._.requestID=u((function t(e){n.call(i,e),i._.requestID=u(t)})),this}function v(){return!this._.visible||this._.paused||(this._.paused=!0,m(this._.requestID),this._.requestID=0),this}function w(){if(!this.media)return this;this.clear(),_(this._.space);var t=f(this.comments,"time",this.media.currentTime);return this._.position=Math.max(0,t-1),this}function y(t){t.play=g.bind(this),t.pause=v.bind(this),t.seeking=w.bind(this),this.media.addEventListener("play",t.play),this.media.addEventListener("pause",t.pause),this.media.addEventListener("playing",t.play),this.media.addEventListener("waiting",t.pause),this.media.addEventListener("seeking",t.seeking)}function x(t){this.media.removeEventListener("play",t.play),this.media.removeEventListener("pause",t.pause),this.media.removeEventListener("playing",t.play),this.media.removeEventListener("waiting",t.pause),this.media.removeEventListener("seeking",t.seeking),t.play=null,t.pause=null,t.seeking=null}function b(t){this._={},this.container=t.container||document.createElement("div"),this.media=t.media,this._.visible=!0;{const t="canvas".toLowerCase();this.engine=t,this._.engine="canvas"===t?h:"pixi"===t?l:n}return this._.requestID=0,this._.speed=Math.max(0,t.speed)||144,this._.duration=4,this.comments=t.comments||[],this.comments.sort(((t,e)=>t.time-e.time)),this.comments.forEach((t=>{t.mode=p(t.mode)})),this._.runningList=[],this._.position=0,this._.paused=!0,this.media&&(this._.listener={},y.call(this,this._.listener)),this._.stage=this._.engine.init(this.container),this._.stage.style?this._.stage.style.cssText+="position:relative;pointer-events:none;":this._.stage.view&&this._.stage.view.style&&(this._.stage.view.style.cssText+="position:relative;pointer-events:none;"),this.resize(),this._.stage.view?this.container.appendChild(this._.stage.view):this.container.appendChild(this._.stage),this._.space={},_(this._.space),this.media&&this.media.paused||(w.call(this),g.call(this)),this}function T(){if(!this.container)return this;for(var t in v.call(this),this.clear(),this.container.removeChild(this._.stage),this.media&&x.call(this,this._.listener),this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return this}var L=["mode","time","text","render","style"];function C(t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return this;for(var e={},i=0;i<L.length;i++)void 0!==t[L[i]]&&(e[L[i]]=t[L[i]]);if(e.text=(e.text||"").toString(),e.mode=p(e.mode),e._utc=Date.now()/1e3,this.media){var n=0;void 0===e.time?(e.time=this.media.currentTime,n=this._.position):(n=f(this.comments,"time",e.time))<this._.position&&(this._.position+=1),this.comments.splice(n,0,e)}else this.comments.push(e);return this}function E(){return this._.visible?this:(this._.visible=!0,this.media&&this.media.paused||(w.call(this),g.call(this)),this)}function z(){return this._.visible?(v.call(this),this.clear(),this._.visible=!1,this):this}function k(){return this._.engine.clear(this._.stage,this._.runningList),this._.runningList=[],this}function S(){return this._.width=this.container.offsetWidth,this._.height=this.container.offsetHeight,this._.engine.resize(this._.stage,this._.width,this._.height),this._.duration=this._.width/this._.speed,this}var F={get:function(){return this._.speed},set:function(t){return"number"!=typeof t||isNaN(t)||!isFinite(t)||t<=0?this._.speed:(this._.speed=t,this._.width&&(this._.duration=this._.width/t),t)}};function A(t){t&&b.call(this,t)}A.prototype.destroy=function(){return T.call(this)},A.prototype.emit=function(t){return C.call(this,t)},A.prototype.show=function(){return E.call(this)},A.prototype.hide=function(){return z.call(this)},A.prototype.clear=function(){return k.call(this)},A.prototype.resize=function(){return S.call(this)},Object.defineProperty(A.prototype,"speed",F);export{A as default};
