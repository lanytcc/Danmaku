!function(){if("undefined"==typeof document)return"transform";for(var t=["oTransform","msTransform","mozTransform","webkitTransform","transform"],e=document.createElement("div").style,i=0;i<t.length;i++)if(t[i]in e)return t[i]}();var t="undefined"!=typeof window&&window.devicePixelRatio||1,e=Object.create(null);function i(i,n){if("function"==typeof i.render){var s=i.render();if(s instanceof HTMLCanvasElement)return i.width=s.width,i.height=s.height,s}var r=document.createElement("canvas"),h=r.getContext("2d"),o=i.style||{};o.font=o.font||"10px sans-serif",o.textBaseline=o.textBaseline||"bottom";var a=1*o.lineWidth;for(var d in a=a>0&&a!==1/0?Math.ceil(a):1*!!o.strokeStyle,h.font=o.font,i.width=i.width||Math.max(1,Math.ceil(h.measureText(i.text).width)+2*a),i.height=i.height||Math.ceil(function(t,i){if(e[t])return e[t];var n=12,s=t.match(/(\d+(?:\.\d+)?)(px|%|em|rem)(?:\s*\/\s*(\d+(?:\.\d+)?)(px|%|em|rem)?)?/);if(s){var r=1*s[1]||10,h=s[2],o=1*s[3]||1.2,a=s[4];"%"===h&&(r*=i.container/100),"em"===h&&(r*=i.container),"rem"===h&&(r*=i.root),"px"===a&&(n=o),"%"===a&&(n=r*o/100),"em"===a&&(n=r*o),"rem"===a&&(n=i.root*o),void 0===a&&(n=r*o)}return e[t]=n,n}(o.font,n))+2*a,r.width=i.width*t,r.height=i.height*t,h.scale(t,t),o)h[d]=o[d];var m=0;switch(o.textBaseline){case"top":case"hanging":m=a;break;case"middle":m=i.height>>1;break;default:m=i.height-a}return o.strokeStyle&&h.strokeText(i.text,a,m),h.fillText(i.text,a,m),r}function n(t){return 1*window.getComputedStyle(t,null).getPropertyValue("font-size").match(/(.+)px/)[1]}var s={name:"canvas",init:function(t){var e=document.createElement("canvas");return e.context=e.getContext("2d"),e._fontSize={root:n(document.getElementsByTagName("html")[0]),container:n(t)},e},clear:function(t,e){t.context.clearRect(0,0,t.width,t.height);for(var i=0;i<e.length;i++)e[i].canvas=null},resize:function(e,i,n){e.width=i*t,e.height=n*t,e.style.width=i+"px",e.style.height=n+"px"},framing:function(t){t.context.clearRect(0,0,t.width,t.height)},setup:function(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.canvas=i(s,t._fontSize)}},render:function(e,i){e.context.drawImage(i.canvas,i.x*t,i.y*t)},remove:function(t,e){e.canvas=null}};function r(t){const e=this,i=e.media?e.media.currentTime:Date.now()/1e3,n=e.media?e.media.playbackRate:1,s=t.mode,r=t.height,h=e._.height,o=Math.floor(h/r);e._.space[s]&&e._.space[s].length===o||(e._.space[s]=new Array(o).fill(null).map(()=>({endTime:0})));const a=e._.space[s];let d=-1;function m(t,e,i,n,s,r){if(!t||!t.endTime)return!0;if(i>=t.endTime)return!0;if("ltr"===s||"rtl"===s){const h=i-t.startTime,o=i-e.time,a=r._.duration/n,d=r._.width,m=h/a*d,c=o/a*d;let u=0,l=0,f=0,p=0;if("rtl"===s?(u=r._.width-m,l=u+t.width,f=r._.width-c,p=f+e.width):(l=-t.width+m,u=l-t.width,p=-e.width+c,f=p-e.width),f<l&&p>u||p>u&&f<l)return!1}if("top"===s||"bottom"===s){const e=r._.duration/n;return i-t.startTime>=e}return!0}for(let r=0;r<o;r++){if(m(a[r],t,i,n,s,e)){d=r;break}}if(-1===d)return-1;const c=e.media?t.time:t._utc,u=c+e._.duration/n;a[d]={startTime:c,endTime:u,width:t.width,height:t.height};return"bottom"===s?h-(d+1)*r:d*r}var h="undefined"!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){return setTimeout(t,50/3)},o="undefined"!=typeof window&&(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||clearTimeout;function a(t,e,i){for(var n=0,s=0,r=t.length;s<r-1;)i>=t[n=s+r>>1][e]?s=n:r=n;return t[s]&&i<t[s][e]?s:r}function d(t){return/^(ltr|top|bottom)$/i.test(t)?t.toLowerCase():"rtl"}function m(t){t.ltr=[],t.rtl=[],t.top=[],t.bottom=[]}function c(){if(!this._.visible||!this._.paused)return this;if(this._.paused=!1,this.media)for(var t=0;t<this._.runningList.length;t++){var e=this._.runningList[t];e._utc=Date.now()/1e3-(this.media.currentTime-e.time)}var i=this,n=function(t,e,i,n){return function(s){let h=s;void 0===h&&(h=Date.now()),t(this._.stage);const o=h/1e3,a=this.media?this.media.currentTime:o,d=this.media?this.media.playbackRate:1;let m=null,c=0,u=0;for(u=this._.runningList.length-1;u>=0;u--){m=this._.runningList[u],c=this.media?m.time:m._utc;const t=(o-m._utc)*d;let e=!1;"top"===m.mode||"bottom"===m.mode?t>this._.duration&&(e=!0):"ltr"===m.mode?m.x>this._.width&&(e=!0):"rtl"===m.mode&&m.x+m.width<0&&(e=!0),e&&(n(this._.stage,m),this._.runningList.splice(u,1))}const l=[];for(;this._.position<this.comments.length&&(m=this.comments[this._.position],c=this.media?m.time:m._utc,!(c>=a));)a-c>this._.duration||(this.media&&(m._utc=o-(this.media.currentTime-m.time)),l.push(m)),++this._.position;for(e(this._.stage,l),u=0;u<l.length;u++)m=l[u],m.y=r.call(this,m),this._.runningList.push(m);for(u=0;u<this._.runningList.length;u++){if(m=this._.runningList[u],-1===m.y)continue;const t=(o-m._utc)*d/this._.duration,e=this._.width*t;"ltr"===m.mode?m.x=-m.width+e:"rtl"===m.mode?m.x=this._.width-e:"top"!==m.mode&&"bottom"!==m.mode||(m.x=(this._.width-m.width)/2),m.element&&m.element.style&&(m.element.style.transform=`translate(${m.x}px, ${m.y}px)`),i(this._.stage,m)}}}(this._.engine.framing.bind(this),this._.engine.setup.bind(this),this._.engine.render.bind(this),this._.engine.remove.bind(this));return this._.requestID=h((function t(){n.call(i),i._.requestID=h(t)})),this}function u(){return!this._.visible||this._.paused||(this._.paused=!0,o(this._.requestID),this._.requestID=0),this}function l(){if(!this.media)return this;this.clear(),m(this._.space);var t=a(this.comments,"time",this.media.currentTime);return this._.position=Math.max(0,t-1),this}function f(t){t.play=c.bind(this),t.pause=u.bind(this),t.seeking=l.bind(this),this.media.addEventListener("play",t.play),this.media.addEventListener("pause",t.pause),this.media.addEventListener("playing",t.play),this.media.addEventListener("waiting",t.pause),this.media.addEventListener("seeking",t.seeking)}function p(t){this.media.removeEventListener("play",t.play),this.media.removeEventListener("pause",t.pause),this.media.removeEventListener("playing",t.play),this.media.removeEventListener("waiting",t.pause),this.media.removeEventListener("seeking",t.seeking),t.play=null,t.pause=null,t.seeking=null}function _(t){this._={},this.container=t.container||document.createElement("div"),this.media=t.media,this._.visible=!0,this.engine="canvas",this._.engine=s,this._.requestID=0,this._.speed=Math.max(0,t.speed)||144,this._.duration=4,this.comments=t.comments||[],this.comments.sort((function(t,e){return t.time-e.time}));for(var e=0;e<this.comments.length;e++)this.comments[e].mode=d(this.comments[e].mode);return this._.runningList=[],this._.position=0,this._.paused=!0,this.media&&(this._.listener={},f.call(this,this._.listener)),this._.stage=this._.engine.init(this.container),this._.stage.style.cssText+="position:relative;pointer-events:none;",this.resize(),this.container.appendChild(this._.stage),this._.space={},m(this._.space),this.media&&this.media.paused||(l.call(this),c.call(this)),this}function g(){if(!this.container)return this;for(var t in u.call(this),this.clear(),this.container.removeChild(this._.stage),this.media&&p.call(this,this._.listener),this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return this}var w=["mode","time","text","render","style"];function v(t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return this;for(var e={},i=0;i<w.length;i++)void 0!==t[w[i]]&&(e[w[i]]=t[w[i]]);if(e.text=(e.text||"").toString(),e.mode=d(e.mode),e._utc=Date.now()/1e3,this.media){var n=0;void 0===e.time?(e.time=this.media.currentTime,n=this._.position):(n=a(this.comments,"time",e.time))<this._.position&&(this._.position+=1),this.comments.splice(n,0,e)}else this.comments.push(e);return this}function y(){return this._.visible?this:(this._.visible=!0,this.media&&this.media.paused||(l.call(this),c.call(this)),this)}function x(){return this._.visible?(u.call(this),this.clear(),this._.visible=!1,this):this}function b(){return this._.engine.clear(this._.stage,this._.runningList),this._.runningList=[],this}function T(){return this._.width=this.container.offsetWidth,this._.height=this.container.offsetHeight,this._.engine.resize(this._.stage,this._.width,this._.height),this._.duration=this._.width/this._.speed,this}var L={get:function(){return this._.speed},set:function(t){return"number"!=typeof t||isNaN(t)||!isFinite(t)||t<=0?this._.speed:(this._.speed=t,this._.width&&(this._.duration=this._.width/t),t)}};function k(t){t&&_.call(this,t)}k.prototype.destroy=function(){return g.call(this)},k.prototype.emit=function(t){return v.call(this,t)},k.prototype.show=function(){return y.call(this)},k.prototype.hide=function(){return x.call(this)},k.prototype.clear=function(){return b.call(this)},k.prototype.resize=function(){return T.call(this)},Object.defineProperty(k.prototype,"speed",L);export{k as default};
